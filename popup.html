<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spocket Image Extractor</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">Spocket Image Extractor</h1>
            <div class="status" id="status">Loading...</div>
        </header>

        <div class="content" id="content">
            <!-- Loading state -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Scanning page for images...</p>
            </div>

            <!-- Error state -->
            <div class="error hidden" id="error">
                <div class="error-icon">‚ö†Ô∏è</div>
                <p class="error-message" id="errorMessage">An error occurred</p>
                <button class="retry-btn" id="retryBtn">Retry</button>
            </div>

            <!-- Main content -->
            <div class="main-content hidden" id="mainContent">
                <!-- Metadata summary -->
                <div class="metadata-section">
                    <h2>Product Information</h2>
                    <div class="metadata-grid">
                        <div class="metadata-item">
                            <label>Product Name:</label>
                            <span id="productName">-</span>
                        </div>
                        <div class="metadata-item">
                            <label>Vendor:</label>
                            <span id="vendorName">-</span>
                        </div>
                        <div class="metadata-item">
                            <label>Price:</label>
                            <span id="price">-</span>
                        </div>
                        <div class="metadata-item">
                            <label>Product ID:</label>
                            <span id="productId">-</span>
                        </div>
                        <div class="metadata-item full-width" id="storeStatusContainer" style="display: none;">
                            <label>Store Status:</label>
                            <span id="storeStatus">-</span>
                        </div>
                        <div class="metadata-item full-width" id="marketplaceContainer" style="display: none;">
                            <label>Marketplace:</label>
                            <span id="marketplaceInfo">-</span>
                        </div>
                    </div>
                </div>

                <!-- AI Analysis Section -->
                <div class="ai-section">
                    <h2>AI Product Analysis</h2>
                    <div class="ai-controls">
                        <button class="ai-analyze-btn" id="aiAnalyzeBtn">
                            <span class="btn-text">Analyze Product</span>
                            <div class="btn-spinner hidden"></div>
                        </button>
                        <button class="api-key-btn" id="apiKeyBtn">Set API Key</button>
                    </div>
                    <div class="ai-results hidden" id="aiResults">
                        <h3>AI Analysis Results:</h3>
                        <div class="ai-description" id="aiDescription"></div>
                    </div>
                    <div class="ai-error hidden" id="aiError">
                        <div class="error-message" id="aiErrorMessage"></div>
                    </div>
                </div>

                <!-- API Key Modal -->
                <div class="modal" id="apiKeyModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Set OpenAI API Key</h3>
                            <button class="modal-close" id="modalClose">&times;</button>
                        </div>
                        <div class="modal-body">
                            <p>Enter your OpenAI API key to enable AI product analysis:</p>
                            <input type="password" id="apiKeyInput" placeholder="sk-..." class="api-key-input">
                            <div class="modal-actions">
                                <button class="save-key-btn" id="saveKeyBtn">Save Key</button>
                                <button class="cancel-btn" id="cancelBtn">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Image selection -->
                <div class="images-section">
                    <div class="images-header">
                        <h2>Images (<span id="imageCount">0</span>)</h2>
                        <div class="selection-controls">
                            <button class="select-all-btn" id="selectAllBtn">Select All</button>
                            <button class="deselect-all-btn" id="deselectAllBtn">Deselect All</button>
                        </div>
                    </div>
                    
                    <div class="images-grid" id="imagesGrid">
                        <!-- Images will be populated here -->
                    </div>
                </div>

                <!-- Action buttons -->
                <div class="actions">
                    <div class="selected-count">
                        <span id="selectedCount">0</span> images selected
                    </div>
                    <div class="action-buttons">
                        <button class="force-retry-btn" id="forceRetryBtn">
                            <span class="btn-text">üîÑ Force Retry</span>
                            <div class="btn-spinner hidden"></div>
                        </button>
                        <button class="download-btn" id="downloadBtn" disabled>
                            <span class="btn-text">Save Selected Images</span>
                            <div class="btn-spinner hidden"></div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Success state -->
            <div class="success hidden" id="success">
                <div class="success-icon">‚úÖ</div>
                <h2>Download Complete!</h2>
                <div class="success-summary" id="successSummary">
                    <p><span id="successCount">0</span> images downloaded successfully</p>
                    <p>Metadata file saved</p>
                </div>
                <button class="done-btn" id="doneBtn">Done</button>
            </div>
        </div>
    </div>

    <script src="popup.js"></script>
</body>
</html>
